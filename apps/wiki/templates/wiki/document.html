{# vim: set ts=2 et sts=2 sw=2: #}
{% extends "wiki/base.html" %}
{% from "wiki/includes/sidebar_modules.html" import document_tabs, document_notifications %}
{# L10n: {t} is the title of the document. {c} is the category. #}
{% set title = _('{t} | {c}')|f(t=document.title, c=document.get_category_display()) %}
{% set classes = 'document' %}

{% if document.parent %}
  {# If there is a parent doc, use it's URL for switching locales. #}
  {% set localizable_url = url('wiki.document', document.parent.slug, locale=settings.WIKI_DEFAULT_LANGUAGE) %}
{% endif %}

{% block content %}
  <article id="wiki-doc">
    {% if related %}
      <section id="related-articles">
        <h1> {{ _('Related Articles') }}</h1>
        <ul>
          {% for art in document.related_documents.all()[0:5] %}
            <li><a href="{{ art.get_absolute_url() }}">{{ art.title }}</a></li>
          {% endfor %}
        </ul>
      </section>
    {% endif %}
    <h1 class="title">{{ document.title }}</h1>
    {% if redirected_from %}
      <div id="redirected-from">
        {{ _('(Redirected from <a href="{href}">{title}</a>)')|fe(href=redirected_from.get_absolute_url()|urlparams(redirect='no'), title=redirected_from.title) }}
      </div>
    {% endif %}
    {% if document.is_majorly_outdated() %}
      <div class="warning-box">
        {% trans url=document.parent.get_absolute_url(), title=document.parent.title %}
          <p>This article may be out of date.</p>
          <p>
            An important change has been made to the English article on which
            this is based. Until this page is updated, you might find this
            helpful: <a href="{{ url }}">{{ title }}</a>
          </p>
        {% endtrans %}
      </div>
    {% endif %}
    <section id="doc-content">
      {% if not fallback_reason %}
        {{ document.html|safe }}
      {% elif fallback_reason == 'no_translation' %}
        <div id="doc-pending-fallback" class="warning-box">
          {% trans help_link=url('wiki.document', 'localize-firefox-help'),
                   locale=settings.LOCALES[request.locale].native %}
            Our volunteers haven't translated this article into {{ locale }} yet.
            <a href="{{ help_link }}">Join us and help get the job done!</a>
          {% endtrans %}
        </div>
        {{ document.html|safe }}
      {% elif fallback_reason == 'translation_not_approved' %}
        <div id="doc-pending-fallback" class="warning-box">
          {# L10n: This is shown for existing, never-approved translations #}
          {% trans %}
            Our volunteers are working on translating this article.
            Until it's ready, maybe the English version can be of some help.
          {% endtrans %}
        </div>
        {{ document.parent.html|safe }}
      {% else %}
        {{ _("This article doesn't have approved content yet.") }}
      {% endif %}
    </section>
    <section id="doc-contributors">
      {% trans contributors=user_list(contributors) %}
        Contributors to this page: {{ contributors }}
      {% endtrans %}
    </section>
  </article>
  {#
  {% include 'wiki/includes/helpful_form.html' %}
  {% include 'wiki/includes/more_help.html' %}
  #}
{% endblock %}

{% block side_top %}
  {{ document_tabs(document, document.parent, user, 'article', settings) }}

  {% if user.is_authenticated() and document %}
    <div id="doc-watch">
      {% if document.is_watched_by(user) %}
        <form action="{{ url('wiki.document_unwatch', document.slug) }}" method="post">
          {{ csrf() }}
          <input type="submit" class="link-btn" value="{{ _('Turn off emails.') }}" />
        </form>
      {% else %}
        <form action="{{ url('wiki.document_watch', document.slug) }}" method="post">
          {{ csrf() }}
          <input type="submit" class="link-btn" value="{{ _('Get emailed when this article changes.') }}" />
        </form>
      {% endif %}
    </div>
  {% endif %}
{% endblock %}

{% block side %}
  {% include 'wiki/includes/support_for_selectors.html' %}
{% endblock %}

{% block breadcrumbs %}
{% endblock %}
